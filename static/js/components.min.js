(function() {function toggleTheme() {const currentTheme = document.documentElement.dataset.theme;const newTheme = currentTheme === 'light' ? 'dark' : 'light';document.documentElement.dataset.theme = newTheme;localStorage.setItem('theme', newTheme);}function addThemeToggleListener() {const themeToggle = document.querySelector('.theme-toggle');if (themeToggle) {themeToggle.addEventListener('click', toggleTheme);}}function setupMobileNav() {const navToggle = document.querySelector('.nav-toggle');const body = document.body;if (navToggle) {navToggle.addEventListener('click', () => {body.classList.toggle('nav-open');});}const navLinks = document.querySelectorAll('.site-nav a');navLinks.forEach(link => {link.addEventListener('click', (e) => {if (!link.classList.contains('nav-dropdown-toggle')) {body.classList.remove('nav-open');}});});document.addEventListener('click', (e) => {if (body.classList.contains('nav-open') &&!e.target.closest('.site-nav') &&!e.target.closest('.nav-toggle')) {body.classList.remove('nav-open');}});}if (document.readyState === 'loading') {document.addEventListener('DOMContentLoaded', () => {addThemeToggleListener();setupMobileNav();});} else {addThemeToggleListener();setupMobileNav();}})();
(function() {
document.addEventListener('click', function(e) {
const toggle = e.target.closest('.nav-dropdown-toggle');
if (toggle) {
e.preventDefault();
e.stopPropagation();
const dropdown = toggle.closest('.nav-dropdown');
const isOpen = dropdown.getAttribute('data-open') === 'true';
document.querySelectorAll('.nav-dropdown[data-open="true"]').forEach(function(openDropdown) {
if (openDropdown !== dropdown) {
openDropdown.setAttribute('data-open', 'false');
const openToggle = openDropdown.querySelector('.nav-dropdown-toggle');
if (openToggle) {
openToggle.setAttribute('aria-expanded', 'false');
}
}
});
dropdown.setAttribute('data-open', isOpen ? 'false' : 'true');
toggle.setAttribute('aria-expanded', isOpen ? 'false' : 'true');
} else {
if (!e.target.closest('.nav-dropdown-menu') && !e.target.closest('.nav-toggle')) {
document.querySelectorAll('.nav-dropdown[data-open="true"]').forEach(function(dropdown) {
dropdown.setAttribute('data-open', 'false');
const toggle = dropdown.querySelector('.nav-dropdown-toggle');
if (toggle) {
toggle.setAttribute('aria-expanded', 'false');
}
});
}
}
});
document.addEventListener('keydown', function(e) {
if (e.key === 'Escape') {
document.querySelectorAll('.nav-dropdown[data-open="true"]').forEach(function(dropdown) {
dropdown.setAttribute('data-open', 'false');
const toggle = dropdown.querySelector('.nav-dropdown-toggle');
if (toggle) {
toggle.setAttribute('aria-expanded', 'false');
toggle.focus();
}
});
}
});
})();
(function() {let searchIndex = null;let searchContainer = null;let searchInput = null;let searchResults = null;let searchResultsInner = null;let currentFocusIndex = -1;let searchType = 'all';let showExcerpt = true;let isCompact = false;let searchToggleBtn = null;function initSiteSearch() {searchContainer = document.querySelector('.site-search');if (!searchContainer) return;searchInput = searchContainer.querySelector('.site-search-input');searchResults = searchContainer.querySelector('.search-results');searchResultsInner = searchContainer.querySelector('.search-results-inner');searchToggleBtn = searchContainer.querySelector('.search-toggle-btn');if (!searchInput || !searchResults) return;searchType = searchContainer.dataset.searchType || 'all';showExcerpt = searchContainer.dataset.showExcerpt !== 'false';isCompact = searchContainer.dataset.compact === 'true';loadSearchIndex();searchInput.addEventListener('input', handleSearchInput);searchInput.addEventListener('keydown', handleKeyboardNavigation);searchInput.addEventListener('focus', handleSearchFocus);if (isCompact && searchToggleBtn) {searchToggleBtn.addEventListener('click', toggleCompactSearch);}document.addEventListener('click', (e) => {if (!searchContainer.contains(e.target)) {hideSearchResults();if (isCompact && searchContainer.classList.contains('expanded')) {collapseCompactSearch();}}});}function toggleCompactSearch() {if (searchContainer.classList.contains('expanded')) {collapseCompactSearch();} else {expandCompactSearch();}}function expandCompactSearch() {searchContainer.classList.add('expanded');searchToggleBtn.setAttribute('aria-expanded', 'true');setTimeout(() => {searchInput.focus();}, 100);}function collapseCompactSearch() {searchContainer.classList.remove('expanded');searchToggleBtn.setAttribute('aria-expanded', 'false');searchInput.value = '';hideSearchResults();}async function loadSearchIndex() {try {const response = await fetch('/static/search-index.json');if (!response.ok) {console.warn('Search index not found');return;}searchIndex = await response.json();} catch (error) {console.error('Failed to load search index:', error);}}function handleSearchInput(e) {const query = e.target.value.trim();if (query.length < 2) {hideSearchResults();return;}performSearch(query);}function handleSearchFocus() {const query = searchInput.value.trim();if (query.length >= 2 && searchResultsInner.children.length > 0) {showSearchResults();}}function performSearch(query) {if (!searchIndex || !searchIndex.items) {showNoResults('Search index not loaded');return;}const lowerQuery = query.toLowerCase();const results = [];let itemsToSearch = searchIndex.items;if (searchType !== 'all') {itemsToSearch = searchIndex.items.filter(item => item.type === searchType);}itemsToSearch.forEach(item => {const titleMatch = item.title.toLowerCase().includes(lowerQuery);const excerptMatch = item.excerpt?.toLowerCase().includes(lowerQuery) || false;const contentMatch = item.content?.toLowerCase().includes(lowerQuery) || false;if (titleMatch || excerptMatch || contentMatch) {let score = 0;if (titleMatch) score += 10;if (excerptMatch) score += 5;if (contentMatch) score += 1;results.push({...item,score});}});results.sort((a, b) => b.score - a.score);const limitedResults = results.slice(0, 10);if (limitedResults.length === 0) {showNoResults(`No results found for "${query}"`);} else {displaySearchResults(limitedResults, query);}}function displaySearchResults(results, query) {currentFocusIndex = -1;const lowerQuery = query.toLowerCase();const resultsHtml = results.map((item, index) => {const titleWithHighlight = highlightText(item.title, query);const excerptWithHighlight = showExcerpt && item.excerpt ?highlightText(item.excerpt, query) : '';return `<a href="${item.url}" class="search-result-item" data-index="${index}" role="option"><span class="search-result-title">${titleWithHighlight}</span><div class="search-result-meta"><span class="search-result-type">${item.type}</span>${item.date ? `<span class="search-result-date">${item.date}</span>` : ''}</div>${excerptWithHighlight ? `<div class="search-result-excerpt">${excerptWithHighlight}</div>` : ''}</a>`;}).join('');searchResultsInner.innerHTML = resultsHtml;showSearchResults();}function highlightText(text, query) {const regex = new RegExp(`(${escapeRegex(query)})`, 'gi');return text.replace(regex, '<mark>$1</mark>');}function escapeRegex(str) {return str.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');}function showNoResults(message) {searchResultsInner.innerHTML = `<div class="search-no-results">${message}</div>`;showSearchResults();}function showSearchResults() {searchResults.removeAttribute('hidden');}function hideSearchResults() {searchResults.setAttribute('hidden', '');currentFocusIndex = -1;clearKeyboardFocus();}function handleKeyboardNavigation(e) {const resultItems = searchResultsInner.querySelectorAll('.search-result-item');if (resultItems.length === 0) return;switch(e.key) {case 'ArrowDown':e.preventDefault();currentFocusIndex++;if (currentFocusIndex >= resultItems.length) {currentFocusIndex = 0;}updateKeyboardFocus(resultItems);break;case 'ArrowUp':e.preventDefault();currentFocusIndex--;if (currentFocusIndex < 0) {currentFocusIndex = resultItems.length - 1;}updateKeyboardFocus(resultItems);break;case 'Enter':e.preventDefault();if (currentFocusIndex >= 0 && resultItems[currentFocusIndex]) {resultItems[currentFocusIndex].click();}break;case 'Escape':hideSearchResults();searchInput.blur();if (isCompact && searchContainer.classList.contains('expanded')) {collapseCompactSearch();}break;}}function updateKeyboardFocus(items) {clearKeyboardFocus();if (currentFocusIndex >= 0 && items[currentFocusIndex]) {items[currentFocusIndex].classList.add('keyboard-focus');items[currentFocusIndex].scrollIntoView({ block: 'nearest' });}}function clearKeyboardFocus() {const focused = searchResultsInner.querySelectorAll('.keyboard-focus');focused.forEach(item => item.classList.remove('keyboard-focus'));}if (document.readyState === 'loading') {document.addEventListener('DOMContentLoaded', initSiteSearch);} else {initSiteSearch();}})();
(function() {
function initSpriteAnimation(container) {
const image = container.dataset.spriteImage;
const sheetWidth = parseInt(container.dataset.spriteWidth);
const sheetHeight = parseInt(container.dataset.spriteHeight);
const frameCount = parseInt(container.dataset.spriteFrames);
const fps = parseInt(container.dataset.spriteFps) || 12;
if (!image || !sheetWidth || !sheetHeight || !frameCount) {
console.warn('Sprite animation missing required attributes');
return;
}
const frameWidth = sheetWidth / frameCount;
let maxWidth = frameWidth;
let maxHeight = sheetHeight;
const inlineStyle = container.getAttribute('style');
if (inlineStyle) {
const widthMatch = inlineStyle.match(/width:\s*(\d+)px/);
const heightMatch = inlineStyle.match(/height:\s*(\d+)px/);
if (widthMatch) maxWidth = parseInt(widthMatch[1]);
if (heightMatch) maxHeight = parseInt(heightMatch[1]);
}
const viewportWidth = window.innerWidth;
const maxAllowedWidth = Math.min(maxWidth, viewportWidth - 40);
const aspectRatio = frameWidth / sheetHeight;
let displayWidth = maxAllowedWidth;
let displayHeight = displayWidth / aspectRatio;
container.style.width = displayWidth + 'px';
container.style.height = displayHeight + 'px';
const canvas = container.querySelector('.sprite-canvas');
canvas.style.backgroundImage = `url(${image})`;
const scaleFactor = displayWidth / frameWidth;
canvas.style.backgroundSize = `${sheetWidth * scaleFactor}px ${sheetHeight * scaleFactor}px`;
let currentFrame = 0;
const frameDelay = 1000 / fps;
function animate() {
const xPos = -(currentFrame * displayWidth);
canvas.style.backgroundPosition = `${xPos}px 0`;
currentFrame = (currentFrame + 1) % frameCount;
}
setInterval(animate, frameDelay);
let resizeTimeout;
window.addEventListener('resize', function() {
clearTimeout(resizeTimeout);
resizeTimeout = setTimeout(function() {
const newViewportWidth = window.innerWidth;
const newMaxAllowedWidth = Math.min(maxWidth, newViewportWidth - 40);
const newDisplayWidth = newMaxAllowedWidth;
const newDisplayHeight = newDisplayWidth / aspectRatio;
container.style.width = newDisplayWidth + 'px';
container.style.height = newDisplayHeight + 'px';
const newScaleFactor = newDisplayWidth / frameWidth;
canvas.style.backgroundSize = `${sheetWidth * newScaleFactor}px ${sheetHeight * newScaleFactor}px`;
}, 250);
});
}
document.addEventListener('DOMContentLoaded', function() {
const sprites = document.querySelectorAll('.sprite-animation');
sprites.forEach(initSpriteAnimation);
});
})();