const phase1Videos = [
'/static/webm/records.webm',
'/static/webm/matrix.webm',
'/static/webm/destiny2.webm',
'/static/webm/space2.webm',
'/static/webm/canada.webm',
'/static/webm/vapor.webm',
'/static/webm/howhigh.webm',
'/static/webm/tech.webm',
'/static/webm/skate.webm',
'/static/webm/standbyme.webm',
'/static/webm/roger.webm',
];
const phase2Video = '/static/webm/space.webm';
const letters   = 'IMAGINATION'.split('');
const container = document.getElementById('imaginationContainer');
const sharedPhase2Video = document.createElement('video');
sharedPhase2Video.src = phase2Video;
sharedPhase2Video.autoplay = false;
sharedPhase2Video.loop = true;
sharedPhase2Video.muted = true;
sharedPhase2Video.playsInline = true;
sharedPhase2Video.preload = 'none';
function getThemeColor() {
return getComputedStyle(document.documentElement).getPropertyValue('--color-primary').trim();
}
letters.forEach((letter, index) => {
const box = document.createElement('div');
box.className = 'letter-box';
const svg = `
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 240">
<text
x="50%"
y="82%"
text-anchor="middle"
font-family="monospace, sans-serif"
font-size="280"
font-weight="900"
fill="white"
>${letter}</text>
</svg>
`;
const encodedSvg = `data:image/svg+xml;utf8,${encodeURIComponent(svg)}`;
const video1 = document.createElement('video');
video1.className = 'letter-video phase1-video';
video1.src = phase1Videos[index];
video1.autoplay = true;
video1.loop = true;
video1.muted = true;
video1.playsInline = true;
video1.preload = 'metadata';
video1.style.webkitMaskImage = `url("${encodedSvg}")`;
video1.style.maskImage = `url("${encodedSvg}")`;
video1.style.webkitMaskSize = '100% 100%';
video1.style.maskSize = '100% 100%';
video1.style.webkitMaskRepeat = 'no-repeat';
video1.style.maskRepeat = 'no-repeat';
video1.style.webkitMaskPosition = 'center';
video1.style.maskPosition = 'center';
const canvas2 = document.createElement('canvas');
canvas2.className = 'letter-video phase2-video';
canvas2.width = 200;
canvas2.height = 200;
canvas2.style.display = 'block';
canvas2.style.opacity = '0';
canvas2.style.webkitMaskImage = `url("${encodedSvg}")`;
canvas2.style.maskImage = `url("${encodedSvg}")`;
canvas2.style.webkitMaskSize = '100% 100%';
canvas2.style.maskSize = '100% 100%';
canvas2.style.webkitMaskRepeat = 'no-repeat';
canvas2.style.maskRepeat = 'no-repeat';
canvas2.style.webkitMaskPosition = 'center';
canvas2.style.maskPosition = 'center';
const textImg = document.createElement('div');
textImg.className = 'letter-text glitch';
textImg.setAttribute('data-text', letter);
textImg.style.display = 'block';
textImg.style.opacity = '0';
textImg.style.background = getThemeColor();
textImg.style.webkitMaskImage = `url("${encodedSvg}")`;
textImg.style.maskImage = `url("${encodedSvg}")`;
textImg.style.webkitMaskSize = '100% 100%';
textImg.style.maskSize = '100% 100%';
textImg.style.webkitMaskRepeat = 'no-repeat';
textImg.style.maskRepeat = 'no-repeat';
textImg.style.webkitMaskPosition = 'center';
textImg.style.maskPosition = 'center';
const cloudImg = document.createElement('img');
cloudImg.className = 'letter-cloud';
cloudImg.src = '/static/images/c.webp';
cloudImg.alt = letter;
cloudImg.style.display = 'block';
cloudImg.style.opacity = '0';
cloudImg.style.webkitMaskImage = `url("${encodedSvg}")`;
cloudImg.style.maskImage = `url("${encodedSvg}")`;
cloudImg.style.webkitMaskSize = '100% 100%';
cloudImg.style.maskSize = '100% 100%';
cloudImg.style.webkitMaskRepeat = 'no-repeat';
cloudImg.style.maskRepeat = 'no-repeat';
cloudImg.style.webkitMaskPosition = 'center';
cloudImg.style.maskPosition = 'center';
box.appendChild(video1);
box.appendChild(canvas2);
box.appendChild(textImg);
box.appendChild(cloudImg);
container.appendChild(box);
});
function updateLetterColors() {
const themeColor = getThemeColor();
document.querySelectorAll('.letter-text').forEach(el => {
el.style.background = themeColor;
});
}
const observer = new MutationObserver((mutations) => {
mutations.forEach((mutation) => {
if (mutation.attributeName === 'data-theme') {
updateLetterColors();
}
});
});
observer.observe(document.documentElement, {
attributes: true,
attributeFilter: ['data-theme']
});
let animationFrameId = null;
let lastVideoRenderTime = 0;
const VIDEO_FRAME_TIME = 1000 / 60;
function renderSharedVideoToCanvases(timestamp) {
if (!timestamp) timestamp = performance.now();
const deltaTime = timestamp - lastVideoRenderTime;
if (deltaTime >= VIDEO_FRAME_TIME) {
lastVideoRenderTime = timestamp - (deltaTime % VIDEO_FRAME_TIME);
const canvases = document.querySelectorAll('.phase2-video');
canvases.forEach(canvas => {
const ctx = canvas.getContext('2d');
if (sharedPhase2Video.readyState >= 2) {
ctx.drawImage(sharedPhase2Video, 0, 0, canvas.width, canvas.height);
}
});
}
if (sharedPhase2Video && !sharedPhase2Video.paused) {
animationFrameId = requestAnimationFrame(renderSharedVideoToCanvases);
}
}
document.addEventListener('visibilitychange', () => {
if (document.hidden) {
document.querySelectorAll('.phase1-video').forEach(video => video.pause());
sharedPhase2Video.pause();
if (animationFrameId) {
cancelAnimationFrame(animationFrameId);
animationFrameId = null;
}
} else {
AnimationCycle.resumeCurrentPhase();
}
});
const AnimationCycle = {
currentPhase: 0,
phases: [
{ name: 'phase1', duration: 8000 },
{ name: 'glitch1', duration: 4000 },
{ name: 'phase2', duration: 8000 },
{ name: 'glitch2', duration: 4000 }
],
animationFrameId: null,
phaseStartTime: null,
accumulatedTime: 0,
lastFrameTime: null,
taglineStartTime: 0,
taglineInitialDelay: 1000,
taglineCharDelay: 200,
taglinePauseAfterReveal: 2500,
init() {
const boxes         = document.querySelectorAll('.letter-box');
const driverText    = document.querySelector('.driver-text');
const driverCloud   = document.querySelector('.driver-cloud');
const driverTagline = document.querySelector('.driver-tagline');
boxes.forEach(box => {
const video1  = box.querySelector('.phase1-video');
const canvas2 = box.querySelector('.phase2-video');
const text    = box.querySelector('.letter-text');
video1.style.opacity = '1';
video1.play().catch(err => console.log('Video autoplay prevented:', err));
canvas2.style.opacity = '0';
text.style.opacity = '0';
});
driverText.style.opacity = '0';
driverCloud.classList.add('active');
driverCloud.style.opacity = '1';
const taglineText = 'Moving Ideas Forward';
driverTagline.innerHTML = taglineText.split('').map(char =>
char === ' ' ? '<span class="space">&nbsp;&nbsp;&nbsp;&nbsp;</span>' : `<span>${char}</span>`
).join('');
this.startCycle();
},
startCycle() {
this.phaseStartTime  = performance.now();
this.lastFrameTime   = this.phaseStartTime;
this.accumulatedTime = 0;
this.currentPhase    = 0;
this.updatePhaseVisuals();
this.animate(this.phaseStartTime);
},
animate(timestamp) {
const TARGET_FPS = 60;
const FRAME_TIME = 1000 / TARGET_FPS;
const deltaTime = timestamp - this.lastFrameTime;
if (deltaTime < FRAME_TIME) {
this.animationFrameId = requestAnimationFrame((ts) => this.animate(ts));
return;
}
this.lastFrameTime = timestamp - (deltaTime % FRAME_TIME);
const clampedDelta = deltaTime < 100 ? deltaTime : 0;
this.accumulatedTime += clampedDelta;
const phase = this.phases[this.currentPhase];
if (phase.name === 'phase2') {
this.updateTaglineAnimation(this.accumulatedTime - this.taglineStartTime);
}
if (this.accumulatedTime >= phase.duration) {
this.accumulatedTime -= phase.duration;
this.currentPhase     = (this.currentPhase + 1) % this.phases.length;
if (this.phases[this.currentPhase].name === 'phase2') {
this.taglineStartTime = this.accumulatedTime;
}
this.updatePhaseVisuals();
}
this.animationFrameId = requestAnimationFrame((ts) => this.animate(ts));
},
updatePhaseVisuals() {
const phase = this.phases[this.currentPhase];
switch(phase.name) {
case 'phase1':
this.showPhase1();
this.showDriverClouds();
break;
case 'glitch1':
this.showGlitch();
this.showDriverText();
break;
case 'phase2':
this.showPhase2();
this.hideDriver();
break;
case 'glitch2':
this.showGlitch();
this.showDriverFadeIn();
break;
}
},
updateTaglineAnimation(elapsedTime) {
const driverTagline = document.querySelector('.driver-tagline');
if (!driverTagline) return;
const chars = driverTagline.querySelectorAll('span');
const totalFadeInTime = chars.length * this.taglineCharDelay;
const totalAnimationTime = this.taglineInitialDelay + totalFadeInTime + this.taglinePauseAfterReveal;
if (elapsedTime < this.taglineInitialDelay) {
chars.forEach(char => char.style.opacity = '0');
} else if (elapsedTime < this.taglineInitialDelay + totalFadeInTime) {
const fadeInElapsed = elapsedTime - this.taglineInitialDelay;
chars.forEach((char, index) => {
const charStartTime = index * this.taglineCharDelay;
if (fadeInElapsed >= charStartTime) {
char.style.opacity = '1';
} else {
char.style.opacity = '0';
}
});
} else if (elapsedTime < totalAnimationTime) {
chars.forEach(char => char.style.opacity = '1');
} else {
chars.forEach(char => char.style.opacity = '0');
}
},
resumeCurrentPhase() {
const phase = this.phases[this.currentPhase];
this.lastFrameTime = performance.now();
switch(phase.name) {
case 'phase1':
this.showPhase1();
break;
case 'phase2':
this.showPhase2();
break;
case 'glitch1':
case 'glitch2':
break;
}
},
showPhase1() {
const boxes = document.querySelectorAll('.letter-box');
if (animationFrameId) {
cancelAnimationFrame(animationFrameId);
animationFrameId = null;
}
sharedPhase2Video.pause();
boxes.forEach(box => {
const video1 = box.querySelector('.phase1-video');
const canvas2 = box.querySelector('.phase2-video');
const text = box.querySelector('.letter-text');
if (video1.paused && !document.hidden) {
video1.play().catch(err => console.log('Video autoplay prevented:', err));
}
video1.style.opacity = '1';
canvas2.style.opacity = '0';
text.style.opacity = '0';
});
},
showPhase2() {
const boxes = document.querySelectorAll('.letter-box');
if (sharedPhase2Video.paused && !document.hidden) {
if (sharedPhase2Video.readyState === 0) {
sharedPhase2Video.load();
}
sharedPhase2Video.currentTime = 0;
sharedPhase2Video.play().then(() => {
renderSharedVideoToCanvases();
}).catch(err => console.log('Video autoplay prevented:', err));
} else if (!animationFrameId && !document.hidden) {
renderSharedVideoToCanvases();
}
boxes.forEach(box => {
const video1 = box.querySelector('.phase1-video');
const canvas2 = box.querySelector('.phase2-video');
const text = box.querySelector('.letter-text');
video1.style.opacity = '0';
canvas2.style.opacity = '1';
text.style.opacity = '0';
});
},
showGlitch() {
const boxes = document.querySelectorAll('.letter-box');
if (animationFrameId) {
cancelAnimationFrame(animationFrameId);
animationFrameId = null;
}
sharedPhase2Video.pause();
boxes.forEach(box => {
const video1  = box.querySelector('.phase1-video');
const canvas2 = box.querySelector('.phase2-video');
const text    = box.querySelector('.letter-text');
video1.style.opacity  = '0';
canvas2.style.opacity = '0';
text.style.opacity    = '1';
});
},
showDriverClouds() {
const driverText  = document.querySelector('.driver-text');
const driverCloud = document.querySelector('.driver-cloud');
requestAnimationFrame(() => {
driverText.style.opacity  = '0';
driverCloud.style.opacity = '1';
});
if (!driverCloud.classList.contains('active')) {
driverCloud.classList.add('active');
}
},
showDriverText() {
const driverText  = document.querySelector('.driver-text');
const driverCloud = document.querySelector('.driver-cloud');
requestAnimationFrame(() => {
driverCloud.style.opacity = '0';
driverText.style.opacity  = '1';
});
},
hideDriver() {
const driverText    = document.querySelector('.driver-text');
const driverCloud   = document.querySelector('.driver-cloud');
const driverTagline = document.querySelector('.driver-tagline');
requestAnimationFrame(() => {
driverCloud.style.opacity = '0';
driverText.style.opacity  = '0';
});
const chars = driverTagline.querySelectorAll('span');
chars.forEach(char => {
char.style.opacity = '0';
});
},
showDriverFadeIn() {
const driverText    = document.querySelector('.driver-text');
const driverCloud   = document.querySelector('.driver-cloud');
const driverTagline = document.querySelector('.driver-tagline');
const chars = driverTagline.querySelectorAll('span');
chars.forEach(char => {
char.style.opacity = '0';
});
requestAnimationFrame(() => {
driverText.style.opacity  = '1';
driverCloud.style.opacity = '0';
});
}
};
AnimationCycle.init();